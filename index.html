<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Monica Chatbot</title>
  <style>
    body{font-family:system-ui,Arial,Helvetica,sans-serif;background:#f6f7fb;margin:0}
    .wrap{max-width:720px;margin:24px auto;background:#fff;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,.06);padding:16px}
    #messages{height:60vh;overflow:auto;padding:8px 0}
    .row{display:flex;margin:8px 0}
    .me{justify-content:flex-end}
    .bubble{max-width:70%;padding:10px 12px;border-radius:16px;white-space:pre-wrap;line-height:1.4}
    .bubble.me{background:#111;color:#fff;border-bottom-right-radius:6px}
    .bubble.bot{background:#f1f3f5;border-bottom-left-radius:6px}
    form{display:flex;gap:8px;margin-top:8px}
    input{flex:1;padding:12px;border:1px solid #e5e7eb;border-radius:12px}
    button{padding:12px 16px;border:0;border-radius:12px;background:#111;color:#fff;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
  </style>
</head>
<body>
  <div class="wrap">
    <h2>ü§ñ Monica Chatbot</h2>

    <div id="messages"></div>

    <form id="chat-form">
      <input id="user-input" placeholder="Nh·∫≠p c√¢u h·ªèi..." autocomplete="off" />
      <button type="submit">G·ª≠i</button>
    </form>
    <small id="status" style="color:#6b7280"></small>
  </div>

  <script>
    const form = document.getElementById('chat-form');
    const input = document.getElementById('user-input');
    const box = document.getElementById('messages');
    const statusEl = document.getElementById('status');

    // gi·ªØ l·ªãch s·ª≠ h·ªôi tho·∫°i ƒë·ªÉ g·ª≠i cho API
    const messages = [
      { role: "system", content: "B·∫°n l√† tr·ª£ l√Ω th√¢n thi·ªán, tr·∫£ l·ªùi ng·∫Øn g·ªçn b·∫±ng ti·∫øng Vi·ªát." }
    ];

    const add = (text, who) => {
      const row = document.createElement('div');
      row.className = 'row ' + (who === 'me' ? 'me' : '');
      const b = document.createElement('div');
      b.className = 'bubble ' + (who === 'me' ? 'me' : 'bot');
      b.textContent = text;
      row.appendChild(b);
      box.appendChild(row);
      box.scrollTop = box.scrollHeight;
    };

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const q = input.value.trim();
      if (!q) return;

      // hi·ªÉn th·ªã tin ng∆∞·ªùi d√πng
      add(q, 'me');
      messages.push({ role: 'user', content: q });
      input.value = '';
      input.focus();

      // g·ªçi API
      statusEl.textContent = 'ƒêang g·ªçi API...';
      try {
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ messages })
        });
        const data = await res.json();

        if (data.error) throw new Error(data.error);
        // L∆ØU √ù: backend c·ªßa em tr·∫£ v·ªÅ { content: "..." } ch·ª© kh√¥ng ph·∫£i { reply }
        const reply = data.content || '(tr·ªëng)';
        add(reply, 'bot');
        messages.push({ role: 'assistant', content: reply });
      } catch (err) {
        add('‚ö†Ô∏è L·ªói: ' + err.message, 'bot');
        console.error(err);
      } finally {
        statusEl.textContent = '';
      }
    });
  </script>
</body>
</html>
